{% extends 'index.html' %}

{% load static %}

{% block stylesheets %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
{% endblock %}

{% block content %}

    <div class="main-content">
        <div class="header-main">
            {% if name == 'Лица' %}
            <a href="{% url 'add-person' %}" id="add-event">Добавить лицо</a>
            {% elif event %}
            <a href="{% url 'add-event' %}" id="add-event">Добавить событие</a>
            {% endif %}
            <div class="sort-search">
                <a id="filter-button">Фильтры</a>
                <a>Сортировка:</a>
                {% if person_num %}
                    <select name="sort" id="sortId">
                        <option value="Без сортировки">Без сортировки</option>
                        <option name="byDateUp" value="По дате: раньше">По обновлению: недавно</option>
                        <option name="byDateDown" value="По дате: позже">По обновлению: давно</option>
                        <option name="byNameUp" value="По фамилии: А-Я">По фамилии: А - Я</option>
                        <option name="byNameDown" value="По фамилии: Я-А">По фамилии: Я - А</option>
                    </select>
                {% else %}
                    <select name="sort" id="sortId">
                        <option value="Без сортировки">Без сортировки</option>
                        <option name="byDateUp" value="По дате: раньше">По дате события: недавно</option>
                        <option name="byDateDown" value="По дате: позже">По дате события: давно</option>
                        <option name="byNameUp" value="По фамилии: А-Я">По филиалу: А - Я</option>
                        <option name="byNameDown" value="По фамилии: Я-А">По филиалу: Я - А</option>
                    </select>
                {% endif %}
                <div class="search">
                    <input type="search" id="search-input">
                    <a id="search-button"><span class="material-symbols-outlined">search</span></a>
                </div>
            </div>
        </div>
        <div class="filter" id="filter">
            <div class="filter-content">
                {% if event %}
                <div>
                    Вид события
                    <select name="filterOption" id="typeFilter">
                        <option value="">Нет</option>
                        {% for i in types %}
                            <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    Дивизион
                    <select name="filterOption" id="divisionFilter">
                        <option value="">Нет</option>
                        <option value="Мытищи">Мытищи</option>
                    </select>
                </div>
                <div>
                    Филиал
                    <select name="filterOption" id="filialFilter">
                        <option value="">Нет</option>
                        <option value="Мытищи">Мытищи</option>
                    </select>
                </div>
                {% else %}
                    <div>
                        Пол
                        <select name="filterOption" id="sexFilter">
                            <option value="Нет">Нет</option>
                            <option value="м">м</option>
                            <option value="ж">ж</option>
                            
                        </select>
                    </div>
                    <div>
                        Страна
                        <select name="filterOption" id="countryFilter">
                            <option value="">Нет</option>
                            {% for i in countries %}
                                <option value="{{ i }}">{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        Область
                        <select name="filterOption" id="regionFilter">
                            <option value="">Нет</option>
                            {% for i in regions  %}
                                <option value="{{ i }}">{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
            </div>
            <div class="filter-btns">
                <a class="filter-button-action" id="filter-accept">Применить фильтры</a>
                <a class="filter-button-action" id="filter-delete">Очистить фильтры</a>
            </div>
        </div>
        <table class="table-main" id="tableMain">
            <h1 id="head" class="header-page">{{ name }}</h1>
            <h3>Найдено записей: <a id="counter"></a></h3>
            {% if person_num %}
                <tr class="header-table">
                    <th hidden>Добавлено/Обновлено</th>
                    <th id="id"><b>№ {{ name_number }}</b></th>
                    <th id=""><b>Фамилия</b></th>
                    <th id=""><b>Имя</b></th>
                    <th id=""><b>Отчество</b></th>
                    <th><b>День рождения</b></th>
                    <th id="empty-col"><b>Действия</b></th>
                </tr>
                <tbody id="tbodyTable">
                    {% for line in person %}
                        <tr>
                            <td hidden>{{ line.add_at|date:'Y-m-d' }}</td>
                            <td id="id">{{ line.id }}</td>
                            <td>{{ line.last_name }}</td>
                            <td>{{ line.first_name }}</td>
                            <td>{{ line.second_name }}</td>
                            <td>{{ line.birthday }}</td>
                            <td id="empty-col">
                                <div>
                                    <a href="{% url 'person' line.id %}">Открыть<span class="material-symbols-outlined">open_in_new</span></a>
                                    <a id="edit" href="">Редактировать<span class="material-symbols-outlined">edit</span></a>
                                </div>
                            </td>
                            <td id="sex" hidden>{{ line.sex }}</td>
                            <td id="country" hidden>{{ line.country }}</td>
                            <td id="region" hidden>{{ line.region }}</td>
                            <td id="fio" hidden>{{ line.intruder_fio }}</td>
                            {% if author.username == line.who_added %}
                                <td id="who_added">{{ line.who_added }}</td>
                            {% endif %}

                        </tr>
                    {% endfor %}
                </tbody>
                
            {% else %}
                <tr class="header-table">
                    <th hidden>Дата изменения</th>
                    <th id="id">№ {{ name_number }}</th>
                    <th id="date">Дата события</th>
                    <th id="type">Вид события</th>
                    <th id="division">Дивизион</th>
                    <th id="filial">Филиал</th>
                    <th id="empty-col">Действия</th>
                </tr>
                <tbody id="tbodyTable">
                    {% for line in violations %}
                    <tr>
                        <td hidden> {{ line.change_date|date:'Y-m-d' }} </td>
                        <td id="id">{{ line.id }}</td>
                        <td id="date">{{ line.date_incedent }}</td>
                        <td id="type">{{ line.type }}</td>
                        <td id="division">{{ line.division }}</td>
                        <td id="filial">{{ line.filial }}</td>
                        <td id="empty-col">
                            <div>
                                <a href="{% url 'event' line.id %}">Открыть<span class="material-symbols-outlined">open_in_new</span></a>
                                <a id="edit" href="">Редактировать<span class="material-symbols-outlined">edit</span></a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            {% endif %}
        </table>
    </div>

{% endblock %}


{% block underscripts %}

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script src="{% static 'js/tools/sorting.js' %}"></script>

{% endblock %}